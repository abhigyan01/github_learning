pipeline {
    agent any    

    environment {
         name= "Abhigyan Bhattacharjee"
        topics = 'DevOps'
        DOCKER_REGISTRY = "abhigyan01"
        IMAGE_NAME = "jenkins"
        IMAGE_TAG = "latest"
        DOCKERFILE_PATH = "Dockerfile" // Path to your Dockerfile
       // DOCKER_REGISTRY = "abhigyan01/jenkins"
       DOCKER_ACCESS_TOKEN = credentials('docker-credentials-id')//docker-hub-credentials
       // DOCKER_ACCESS_TOKEN = credentials('docker-hub-credentials')
    }
   // parameters {
     //   string(name:"person", defaultValue:"nothing", description:"")
    //}
    stages{
        stage("Hello"){
            steps{
                echo "My name is $name"
                echo "I want to work on $topics field, Here I am using global veriable"
            }
        }
        
        stage("Code"){
                environment {
                name= "Abhi"
                    topics = 'local'
                }
            steps{
                echo "My name is $name "
                echo "Here I am using $topics variable"
            }
        }
        stage("build"){
            steps{
                sh 'cal 10 2023'
           //     echo "My name is $person "
            }
        }
        stage("deploy"){
            steps{
                sh'''
                touch file
                uptime
                uname
                '''
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    // Build the Docker image
                    //docker.build("$DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG", "-f $DOCKERFILE_PATH .")
                    sh "docker build -t $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG -f $DOCKERFILE_PATH ."

                }
            }
        }
        stage('Push Docker Image') {
            steps {
               script {
                    // Login to Docker registry using access token
                    withDockerRegistry([credentialsId: 'docker-credentials-id']) {
                    sh "docker login -u _token -p $DOCKER_ACCESS_TOKEN $DOCKER_REGISTRY"
                    }
                   // Push Docker image to registry
                    sh "docker push $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG"
                } 
            }  
        }
    } 
}