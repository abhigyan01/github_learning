pipeline {
    agent any    

    environment {
         name= "Abhigyan Bhattacharjee"
        topics = 'DevOps'
        DOCKER_REGISTRY = "abhigyan01"
        IMAGE_NAME = "jenkins"
        IMAGE_TAG = "latest"
        DOCKERFILE_PATH = "Dockerfile" // Path to your Dockerfile
    }
   // parameters {
     //   string(name:"person", defaultValue:"nothing", description:"")
    //}
    stages{
        stage("Hello"){
            steps{
                echo "My name is $name"
                echo "I want to work on $topics field, Here I am using global veriable"
            }
        }
        
        stage("Code"){
                environment {
                name= "Abhi"
                    topics = 'local'
                }
            steps{
                echo "My name is $name "
                echo "Here I am using $topics variable"
            }
        }
        stage("build"){
            steps{
                sh 'cal 10 2023'
           //     echo "My name is $person "
            }
        }
        stage("deploy"){
            steps{
                sh'''
                touch file
                uptime
                uname
                '''
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    // Build the Docker image
                    //docker.build("$DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG", "-f $DOCKERFILE_PATH .")
                    //sh "docker build -t $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG -f $DOCKERFILE_PATH ."
                     withCredentials([usernamePassword(credentialsId: 'docker-credentials-id', usernameVariable: 'DOCKER_USERNAME', passwordVariable: 'DOCKER_PASSWORD')]) {
                        sh "docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD $DOCKER_REGISTRY"
                        sh "docker push $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG"
                }
            }
        }
         stage('Push Docker Image') {
            steps {
                script {
                   /* // Push the Docker image to the registry
                    docker.withRegistry("$DOCKER_REGISTRY", 'docker-credentials-id') {
                        def dockerImage = docker.image("$DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG")
                        dockerImage.push()*/
                      //  docker login -u "$DOCKER_REGISTRY" -p "docker-credentials-id"
                    sh 'docker push $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG'
                    }
                }
            }  
     }
}